const{app,BrowserWindow,shell,ipcMain}=require("electron"),path=require("path"),fs=require("fs");let mainWindow;const initPath="init.json";function createWindow(){let n;try{n=JSON.parse(fs.readFileSync(initPath,"utf8"))}catch(n){console.log("Unable to read init.json: ",n)}const i=n&&n.bounds?n.bounds:{width:1280,height:800};mainWindow=new BrowserWindow({width:i.width,height:i.height,webPreferences:{preload:path.join(__dirname,"electron-globals.js")}}),n&&n.bounds.x&&n.bounds.y&&(mainWindow.x=n.bounds.x,mainWindow.y=n.bounds.y),mainWindow.setMenu(null),mainWindow.setMenuBarVisibility(!1),mainWindow.setAutoHideMenuBar(!0),mainWindow.loadFile("index.html");var e=(n,i)=>{i!=mainWindow.webContents.getURL()&&(n.preventDefault(),shell.openExternal(i))};mainWindow.webContents.on("will-navigate",e),mainWindow.webContents.on("new-window",e),mainWindow.on("close",(function(){let n={bounds:mainWindow.getBounds()};try{fs.writeFileSync(initPath,JSON.stringify(n))}catch(n){console.log("Unable to save save init.json: ",n)}})),mainWindow.on("closed",(function(){mainWindow=null})),app.on("browser-window-focus",(function(){setTimeout((function(){mainWindow.webContents.focus()}),0),setTimeout((function(){mainWindow.webContents.executeJavaScript('document.getElementById("sendMessage").focus()')}),0)}))}app.on("ready",(function(){createWindow()})),ipcMain.on("badge",(function(n,i){if("darwin"===process.platform)app.dock.setBadge(String(i));else if("win32"===process.platform){let n=parseInt(i,10);if(isNaN(n))return;n>0?mainWindow.setOverlayIcon(__dirname+"/assets/img/favicon.ico",String(i)):mainWindow.setOverlayIcon(null,"")}})),app.on("window-all-closed",(function(){"darwin"!==process.platform&&app.quit()})),app.on("activate",(function(){null===mainWindow&&createWindow()}));